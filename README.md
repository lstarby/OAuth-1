## 概览 

 1. ONES.Game Ones游戏DeFi开放平台基于OAuth2.0协议实现 
 2. 目前包含主要由登录授权和支付两大功能模块构成，即ONES DID和ONES Pay
 3. **目前接口未完全实现，请先确认对接方案**

## 登录授权流程图

 1. 用户点击接入方游戏，接入方游戏判断当前是否登录，未登录由用户点击跳转到ONES授权界面，跳转链接需含有appid,scopes,state,device以及redirect_url等信息 查看客户端请求方式 

 2. 用户同意授权后，Ones会提供一个AccessCode，并携带此参数跳转到接入方指定的地址（获取AccessCode的流程也可以使用Ones统一提供的页面处理，但是这样的话用户要进行登录授权就必须从Ones的开放平台列表进入了）

 3. 接入方拿到AccessCode后，需要由接入方服务端带着此AccessCode，以及AccessKey及其签名校验请求Ones，获取AccessToken，签名方式见后续说明

 4. AccessKey与SecretKey是重要信息，请勿跟随客户端分发
   
 5.【待补充流程图】

## 币币账户支付流程图

 ![支付流程图](./docs/cn/images/Ones开放平台-币币账户支付流程图.png) 

 1. 玩家在接入方前端页面发起申请支付，接入方服务端生成订单号，金额等信息向ONES服务端发起支付请求
 2. ONES服务端接受请求之后会返回支付地址，接入方前端跳转到ONES支付地址
 3. 玩家在ONES支付前端上输入验证码及支付密码 
 4. ONES服务端校验成功之后，ONES支付前端调整到接入方指定的redirect_url地址 
 5. 支付成功后，除了跟随HTTP请求返回支付状态外，还会有异步回调告诉接入方Server端（Ones无法保证HTTP请求与回调到达的先后顺序，需接入方自行处理可能出现的情况）
 6. 接入方第三方前端接受到支付的回调后，请求服务端判断是否已支付成功


## 目录

1. [服务端请求方式](./docs/cn/1.服务端请求方式.md)
   
2. [客户端请求方式](./docs/cn/2.客户端请求方式.md)

3. [登录相关接口](./docs/cn/3.登录相关接口.md)

4. [支付相关接口](./docs/cn/4.支付相关接口.md)

5. [附录](./docs/cn/5.附录.md)

6. [错误码](./docs/cn/6.错误码.md)

7. [常见问题解答](./docs/cn/7.FAQ.md)


## 对接流程 【跳过】

1. 填写入驻申请表

2. 产品初审：Ones工作人员将联系申请者进行商务对接，若初审通过进行后续流程

3. 商务对接：双方商务确定接入币种、产品运营模式、保证金等

4. 技术对接
   
   1. 建立技术对接群，确定对接日程
   
   2. 添加访问测试环境的权限（测试环境有访问限制，没有添加访问权限是无法访问的），并给接入方提供测试环境访问地址
   
   3. 接入方在测试环境[注册](https://play.ones.game/account/register)测试账号：用于设置APP的一些信息，如支付回调地址等。建议使用公司邮箱或公司专用手机号注册，避免因公司人员变动产生不必要的麻烦。
   
   4. 将注册好的账号提供给Ones开发人员，由Ones开发添加APP信息。App管理员账号会被冻结交易、提现等与资金相关的权限，分润账号各项权限均正常

   5. 接入方登录管理员账号，进入[“个人中心”-->“开放平台”](https://play.ones.game/asset/open/app)，创建AccessKey与SecretKey、配置支付回调地址等

       1. **注意**：更新**响应数据校验秘钥**后，前端展示会立即修改，但是Ones实际进行签名的会有一小段延时（1H内全部切换为新的秘钥），在此期间可能有部分使用新的秘钥，部分使用旧的秘钥，需接入方在更改秘钥时注意下。

   6. 阅读本文档，进行开发（建议读完本README后，按[目录](#目录)顺序，了解我们提供的接口是否满足您的需求），有疑问可在群里咨询Ones开发人员

   7. 接入方自测

   8. ONES验收（第三方产品流程、产品数据、对账）

5. 正式上线

   1. 接入方在正式环境[注册](https://play.ones.game/account/register)**一个**账号，与在测试环境一致

   2. 接入方填写[《Ones开放平台第三方APP信息录入表》]
   
   3. Ones工作人员录入正式环境产品信息（不会展示在开放平台的应用列表）
   
   4. 接入方登录管理员账号，进入[“个人中心”-->“开放平台”](https://play.ones.game/open/app)，创建AccessKey与SecretKey、配置支付回调地址等，与测试环境一致
   
   5. 接入方部署上线，提供正式环境产品链接
   
   6. Ones工作人员提供给小部分用户线上灰度测试
   
   7. 灰度测试通过，Ones安排开放平台导流

6. 上线后接入方需留意线上数据，并有人负责解答用户疑问